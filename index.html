<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>

    <div class="header-container">
        <h2>ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆ</h2>
        <button class="send-all-button" onclick="shareSetlist()">ğŸ“¤ å…±æœ‰</button>
    </div>
    <div class="setlist-container">
        <ul id="setlist"></ul>
    </div>

<!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div class="menu-button" id="menuButton" onclick="toggleMenu()">
    <span></span>
    <span></span>
    <span></span>
</div>
<div class="menu" id="menu">
    <div class="close-button" onclick="toggleMenu()"></div> <!-- âœ–ãƒœã‚¿ãƒ³ -->
    
    <h3>ã‚¢ãƒ«ãƒãƒ ã‚’é¸æŠ</h3>
    
    <!-- ã‚¢ãƒ«ãƒãƒ ãƒªã‚¹ãƒˆ -->
    <ul class="album-list">
        <li class="album1-tab" onclick="toggleAlbum(1)">SEãƒ»ã‚¤ãƒ³ã‚¹ãƒˆ</li>
        <ul class="album-content" id="album1">
            <li class="item album1" draggable="true">SE</li>
            <li class="item album1" draggable="true">MC</li>
            <li class="item album1" draggable="true">ã‚¤ãƒ³ã‚¹ãƒˆ</li>
            <li class="item album1" draggable="true">Drumâ€™n SAX SE</li>
            <li class="item album1" draggable="true">Timeless</li>
            <li class="item album1" draggable="true">THE ONE</li>
            <li class="item album1" draggable="true">TYCOON</li>
            <li class="item album1" draggable="true">UNSER</li>
            <li class="item album1" draggable="true">NEVER ENDING WORLD</li>
            <li class="item album1" draggable="true">EYEWALL</li>
            <li class="item album1" draggable="true">ENIGMASIS</li>
            <li class="item album1" draggable="true">Ã¼ber cozy universe</li>
            <li class="item album1" draggable="true">å’ŒéŸ³ the stoic</li>
            <li class="item album1" draggable="true">over the stoic</li>
            <li class="item album1" draggable="true">Massive</li>
            <li class="item album1" draggable="true">CORE STREAM</li>
            <li class="item album1" draggable="true">Spreadown</li>
            <li class="item album1" draggable="true">to the world</li>
            <li class="item album1" draggable="true">ANOMALYå¥è€…</li>
            <li class="item album1" draggable="true">Highlight!!</li>
        </ul>
    
        <li class="album2-tab" onclick="toggleAlbum(2)">Timeless</li>
        <ul class="album-content" id="album2">
            <li class="item album2" draggable="true">CHANCE!</li>
            <li class="item album2" draggable="true">ãƒˆã‚­ãƒãƒŠãƒŸãƒ€</li>
            <li class="item album2" draggable="true">Rush</li>
            <li class="item album2" draggable="true">D-tecnoLife</li>
            <li class="item album2" draggable="true">å„ªã—ã•ã®é›«</li>
            <li class="item album2" draggable="true">ai ta å¿ƒ</li>
            <li class="item album2" draggable="true">Burst</li>
            <li class="item album2" draggable="true">Nitro</li>
            <li class="item album2" draggable="true">just Melody</li>
            <li class="item album2" draggable="true">Lump Of Affection</li>
            <li class="item album2" draggable="true">æ‰‰</li>
        </ul>
    
        <li class="album3-tab" onclick="toggleAlbum(3)">BUGRIGHT</li>
        <ul class="album-content" id="album3">
            <li class="item album3" draggable="true">ã‚¼ãƒ­ã®ç­”</li>
            <li class="item album3" draggable="true">SHAMROCK</li>
            <li class="item album3" draggable="true">Home å¾®ç†±39â„ƒ</li>
            <li class="item album3" draggable="true">ã€œæµã‚Œãƒ»ç©ºè™šãƒ»THIS WORDã€œ</li>
            <li class="item album3" draggable="true">Colors of the Heart</li>
            <li class="item album3" draggable="true">Live everyday as if it were the last day</li>
            <li class="item album3" draggable="true">ã‚·ãƒ£ãƒ«ãƒãƒ³ãƒã‚¦ãƒ©</li>
            <li class="item album3" draggable="true">ä¸€äººã˜ã‚ƒãªã„ã‹ã‚‰</li>
            <li class="item album3" draggable="true">å›ã®å¥½ããªã†ãŸ</li>
            <li class="item album3" draggable="true">51%</li>
            <li class="item album3" draggable="true">LIFEsize</li>
            <li class="item album3" draggable="true">EMPTY96</li>
            <li class="item album3" draggable="true">DISCORD</li>
        </ul>
    
        <li class="album4-tab" onclick="toggleAlbum(4)">PROGLUTION</li>
        <ul class="album-content" id="album4">
            <li class="item album4" draggable="true">Roots</li>
            <li class="item album4" draggable="true">brand new ancient</li>
            <li class="item album4" draggable="true">æµ®ä¸–CROSSING</li>
            <li class="item album4" draggable="true">ç—…çš„å¸Œæ±‚æ—¥è¨˜</li>
            <li class="item album4" draggable="true">counting song-H</li>
            <li class="item album4" draggable="true">ã‚·ãƒ£ã‚«ãƒ“ãƒ¼ãƒ</li>
            <li class="item album4" draggable="true">GROOVY GROOVY GROOVY</li>
            <li class="item album4" draggable="true">expod-digital</li>
            <li class="item album4" draggable="true">UNKNOWN ORCHESTRA</li>
            <li class="item album4" draggable="true">ç¥é›†ã‚</li>
            <li class="item album4" draggable="true">ENERGY</li>
            <li class="item album4" draggable="true">endscape</li>
            <li class="item album4" draggable="true">å¿ƒãŒæŒ‡ã™å ´æ‰€ã¨å£ç™–ãã—ã¦å›ã¯ã¤ã„ã¦ãã‚‹</li>
            <li class="item album4" draggable="true">ã‚ªãƒˆãƒãƒ</li>
        </ul>
    
        <li class="album5-tab" onclick="toggleAlbum(5)">AwakEVE</li>
        <ul class="album-content" id="album5">
            <li class="item album5" draggable="true">æ¿€å‹•</li>
            <li class="item album5" draggable="true">99/100 é¨™ã—ã®å“²</li>
            <li class="item album5" draggable="true">ç¾å½±æ„å¿—</li>
            <li class="item album5" draggable="true">ã‚³ãƒ­ãƒŠ</li>
            <li class="item album5" draggable="true">å„šãã‚‚æ°¸ä¹…ã®ã‚«ãƒŠã‚·</li>
            <li class="item album5" draggable="true">earthy world</li>
            <li class="item album5" draggable="true">ç•¢ç”Ÿçšæœˆãƒ—ãƒ­ãƒ­ãƒ¼ã‚°</li>
            <li class="item album5" draggable="true">ã‚¢ã‚¤ãƒ»ã‚¢ãƒ  Riri</li>
            <li class="item album5" draggable="true">æ‹ã„ã—ãã¦</li>
            <li class="item album5" draggable="true">Forget</li>
            <li class="item album5" draggable="true">Just break the limit!</li>
            <li class="item album5" draggable="true">WAON THE STOIC</li>
            <li class="item album5" draggable="true">ãƒãƒ«ã‚¸ã‚ªãƒ³</li>
            <li class="item album5" draggable="true">YURAYURA</li>
        </ul>
    
        <li class="album6-tab" onclick="toggleAlbum(6)">LAST</li>
        <ul class="album-content" id="album6">
            <li class="item album6" draggable="true">GOLD</li>
            <li class="item album6" draggable="true">world LOST world</li>
            <li class="item album6" draggable="true">ã‚¹ãƒ‘ãƒ«ã‚¿</li>
            <li class="item album6" draggable="true">å¿ƒã¨ã‚³ã‚³ãƒ­</li>
            <li class="item album6" draggable="true">the truth</li>
            <li class="item album6" draggable="true">ãƒãƒ¼ãƒ¬ãƒ«</li>
            <li class="item album6" draggable="true">ãƒã‚¤!å•é¡Œä½œ</li>
            <li class="item album6" draggable="true">closed POKER</li>
            <li class="item album6" draggable="true">å“€ã—ã¿ã¯ãã£ã¨</li>
            <li class="item album6" draggable="true">CHANGE</li>
            <li class="item album6" draggable="true">WANNA be BLILLIANT</li>
            <li class="item album6" draggable="true">å›ã®ã¾ã¾</li>
            <li class="item album6" draggable="true">GO-ON</li>
        </ul>
    
        <li class="album7-tab" onclick="toggleAlbum(7)">LIFE 6 SENCE</li>
        <ul class="album-content" id="album7">
            <li class="item album7" draggable="true">CORE PRIDE</li>
            <li class="item album7" draggable="true">ã„ã¤ã‹å¿…ãšæ­»ã¬ã“ã¨ã‚’å¿˜ã‚Œã‚‹ãª</li>
            <li class="item album7" draggable="true">ä¸€çŸ³ã‚’æŠ•ã˜ã‚‹Tokyo Midnight Sun</li>
            <li class="item album7" draggable="true">ace of ace</li>
            <li class="item album7" draggable="true">NO.1</li>
            <li class="item album7" draggable="true">ã‚¯ã‚ªãƒªã‚¢</li>
            <li class="item album7" draggable="true">ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ</li>
            <li class="item album7" draggable="true">å‹è€…è‡†ç—…è€…</li>
            <li class="item album7" draggable="true">ï¼–ã¤ã®é¢¨</li>
            <li class="item album7" draggable="true">ä¸€å„„åˆ†ã®ä¸€ã®å°èª¬</li>
            <li class="item album7" draggable="true">MONDO PIECE</li>
            <li class="item album7" draggable="true">ç™½æ˜¼å¤¢</li>
        </ul>
    
        <li class="album8-tab" onclick="toggleAlbum(8)">THE ONE</li>
        <ul class="album-content" id="album8">
            <li class="item album8" draggable="true">7th Trigger</li>
            <li class="item album8" draggable="true">Don't think feel</li>
            <li class="item album8" draggable="true">LIMITLESS</li>
            <li class="item album8" draggable="true">23ãƒ¯ãƒ¼ãƒ‰</li>
            <li class="item album8" draggable="true">KINJITO</li>
            <li class="item album8" draggable="true">THE OVER </li>
            <li class="item album8" draggable="true">æ­¤å‡¦ã‹ã‚‰</li>
            <li class="item album8" draggable="true">REVERSI</li>
            <li class="item album8" draggable="true">ãƒãƒ¼ãƒ™ãƒ«</li>
            <li class="item album8" draggable="true">BABY BORN & GO</li>
            <li class="item album8" draggable="true">AWAYOKUBA-æ–¬ã‚‹</li>
            <li class="item album8" draggable="true">NOWHERE boy</li>
        </ul>
    
        <li class="album9-tab" onclick="toggleAlbum(9)">Ã˜ choir</li>
        <ul class="album-content" id="album9">
            <li class="item album9" draggable="true">é›¶HEREï½SEï½</li>
            <li class="item album9" draggable="true">IMPACT</li>
            <li class="item album9" draggable="true">èª°ãŒè¨€ã£ãŸ</li>
            <li class="item album9" draggable="true">ãƒŠãƒãƒ»ã‚»ã‚«ãƒ³ãƒ‰</li>
            <li class="item album9" draggable="true">Fight For Liberty</li>
            <li class="item album9" draggable="true">ENOUGH-1</li>
            <li class="item album9" draggable="true">KickãŒè‡ªç”±</li>
            <li class="item album9" draggable="true">a LOVELY TONE</li>
            <li class="item album9" draggable="true">ï¼—æ—¥ç›®ã®æ±ºæ„</li>
            <li class="item album9" draggable="true">åˆ¥ä¸–ç•Œ</li>
            <li class="item album9" draggable="true">Born Slippy</li>
            <li class="item album9" draggable="true">Wizard CLUB</li>
            <li class="item album9" draggable="true">åœ¨ã‚‹ã¹ãå½¢</li>
            <li class="item album9" draggable="true">Ã˜ choir</li>
        </ul>
    
        <li class="album10-tab" onclick="toggleAlbum(10)">TYCOON</li>
        <ul class="album-content" id="album10">
            <li class="item album10" draggable="true">Q.E.D.</li>
            <li class="item album10" draggable="true">ã‚·ãƒªã‚¦ã‚¹</li>
            <li class="item album10" draggable="true">SHOUT LOVE</li>
            <li class="item album10" draggable="true">IDEAL REALITY</li>
            <li class="item album10" draggable="true">LONE WOLF</li>
            <li class="item album10" draggable="true">DECIDED</li>
            <li class="item album10" draggable="true">PRAYING RUN</li>
            <li class="item album10" draggable="true">ALL ALONE</li>
            <li class="item album10" draggable="true">ä¸€æ»´ã®å½±éŸ¿</li>
            <li class="item album10" draggable="true">ã»ã‚“ã®å°‘ã—</li>
            <li class="item album10" draggable="true">åƒ•ã®è¨€è‘‰ã§ã¯ãªã„ ã“ã‚Œã¯åƒ•ãŸã¡ã®è¨€è‘‰</li>
            <li class="item album10" draggable="true">WE ARE GO</li>
            <li class="item album10" draggable="true">Collide</li>
            <li class="item album10" draggable="true">å¥å…¨åŸŸ</li>
            <li class="item album10" draggable="true">I LOVE THE WORLD</li>
            <li class="item album10" draggable="true">ã‚¨ãƒŸãƒ¥ãƒ¼</li>
            <li class="item album10" draggable="true">çµ‚ç„‰</li>
        </ul>
    
        <li class="album11-tab" onclick="toggleAlbum(11)">UNSER</li>
        <ul class="album-content" id="album11">
            <li class="item album11" draggable="true">Making it Drive</li>
            <li class="item album11" draggable="true">AFTER LIFE</li>
            <li class="item album11" draggable="true">Touch off</li>
            <li class="item album11" draggable="true">å¢ƒç•Œ</li>
            <li class="item album11" draggable="true">stay on</li>
            <li class="item album11" draggable="true">First Sight</li>
            <li class="item album11" draggable="true">ODD FUTURE</li>
            <li class="item album11" draggable="true">ç„¡æ„å‘³ã«ãªã‚‹å¤œ</li>
            <li class="item album11" draggable="true">EDENã¸</li>
            <li class="item album11" draggable="true">ConneQt</li>
            <li class="item album11" draggable="true">OXYMORON</li>
            <li class="item album11" draggable="true">One Last Time</li>
            <li class="item album11" draggable="true">ROB THE FRONTIER</li>
            <li class="item album11" draggable="true">GOOD and EVIL</li>
            <li class="item album11" draggable="true">UNSER (SE)</li>
        </ul>
    
        <li class="album12-tab" onclick="toggleAlbum(12)">30</li>
        <ul class="album-content" id="album12">
            <li class="item album12" draggable="true">EN</li>
            <li class="item album12" draggable="true">One stroke for freedom</li>
            <li class="item album12" draggable="true">ãˆãã¼</li>
            <li class="item album12" draggable="true">OUR ALWAYS</li>
            <li class="item album12" draggable="true">AVALANCHE</li>
            <li class="item album12" draggable="true">THUG LIFE</li>
            <li class="item album12" draggable="true">SOUL</li>
            <li class="item album12" draggable="true">æ¥é³¥æ±Ÿ</li>
            <li class="item album12" draggable="true">NAMELY</li>
            <li class="item album12" draggable="true">ã‚¤ãƒ¼ãƒ†ã‚£ãƒ¼</li>
            <li class="item album12" draggable="true">AS ONE</li>
            <li class="item album12" draggable="true">HOURGLASS</li>
            <li class="item album12" draggable="true">NEVER ENDING WORLD</li>
        </ul>
    
        <li class="album13-tab" onclick="toggleAlbum(13)">ENIGMASIS</li>
        <ul class="album-content" id="album13">
            <li class="item album13" draggable="true">ãƒ“ã‚¿ãƒ¼ã‚¹ã‚¦ã‚£ãƒ¼ãƒˆ</li>
            <li class="item album13" draggable="true">VICTOSPIN</li>
            <li class="item album13" draggable="true">ENCORE AGAIN</li>
            <li class="item album13" draggable="true">FINALIST</li>
            <li class="item album13" draggable="true">echoOZ</li>
            <li class="item album13" draggable="true">Donâ€™t Think.Sing</li>
            <li class="item album13" draggable="true">Î±-Skill</li>
            <li class="item album13" draggable="true">two Lies</li>
            <li class="item album13" draggable="true">THEORY</li>
            <li class="item album13" draggable="true">ãƒ”ã‚°ãƒãƒªã‚ªãƒ³</li>
            <li class="item album13" draggable="true">ANOMALYå¥è€…</li>
            <li class="item album13" draggable="true">ENIGMASIS</li>
        </ul>
    
        <li class="album14-tab" onclick="toggleAlbum(14)">â€»SINGLE ONLY</li>
        <ul class="album-content" id="album14">
            <li class="item album14" draggable="true">MIXED-UP</li>
            <li class="item album14" draggable="true">Revolve</li>
            <li class="item album14" draggable="true">PRIME</li>
            <li class="item album14" draggable="true">SHINE</li>
            <li class="item album14" draggable="true">SORA</li>
            <li class="item album14" draggable="true">åƒ•ã«é‡ãªã£ã¦ãã‚‹ä»Š</li>
            <li class="item album14" draggable="true">=</li>
            <li class="item album14" draggable="true">EXTREAME</li>
            <li class="item album14" draggable="true">ãƒ¢ãƒã‚¯ãƒ­ãƒ¼ãƒ </li>
            <li class="item album14" draggable="true">Rainy</li>
            <li class="item album14" draggable="true">å‡›å¥</li>
            <li class="item album14" draggable="true">å¿—</li>
            <li class="item album14" draggable="true">over the stoic</li>
            <li class="item album14" draggable="true">ä½“æ¸©</li>
            <li class="item album14" draggable="true">ãƒãƒ€ãƒ©è¶</li>
            <li class="item album14" draggable="true">æ’ƒç ´</li>
            <li class="item album14" draggable="true">D-tecnoRize</li>
            <li class="item album14" draggable="true">MINORI</li>
            <li class="item album14" draggable="true">è‹¥ã•æ•…ã‚¨ãƒ³ãƒ†ãƒ¬ã‚±ã‚¤ã‚¢</li>
            <li class="item album14" draggable="true">ãƒ‘ãƒ‹ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ«ãƒ‰</li>
            <li class="item album14" draggable="true">é­‘é­…é­é­ãƒãƒ¼ãƒ</li>
            <li class="item album14" draggable="true">å¢ƒåœ°ãƒ»ãƒãƒ³ãƒˆãƒ©</li>
            <li class="item album14" draggable="true">THE SONG</li>
            <li class="item album14" draggable="true">Massive</li>
            <li class="item album14" draggable="true">DEJAVU</li>
            <li class="item album14" draggable="true">LIFE</li>
            <li class="item album14" draggable="true">è¨€ã‚ãªãã¦ä¼ã‚ã‚‹ã€€ã‚ã‚Œã¯å°‘ã—å˜˜ã </li>
            <li class="item album14" draggable="true">DIS is TEKI</li>
            <li class="item album14" draggable="true">RANGE</li>
            <li class="item album14" draggable="true">PLOT</li>
            <li class="item album14" draggable="true">CORE STREAM</li>
            <li class="item album14" draggable="true">Forever Young</li>
            <li class="item album14" draggable="true">ONE LIFE</li>
            <li class="item album14" draggable="true">Spreadown</li>
            <li class="item album14" draggable="true">Teenage LOVE</li>
            <li class="item album14" draggable="true">LIVIN' IT UP</li>
            <li class="item album14" draggable="true">BVCK</li>
            <li class="item album14" draggable="true">Eye's Sentry</li>
            <li class="item album14" draggable="true">High Light!!</li>
            <li class="item album14" draggable="true">Ã¼ber cozy universe</li>
            <li class="item album14" draggable="true">MEMORIES of the End</li>
            <li class="item album14" draggable="true">PHOENIX</li>
            <li class="item album14" draggable="true">Countdown</li>
            <li class="item album14" draggable="true">MMH</li>
            <li class="item album14" draggable="true">WINGS ever</li>
        </ul>
    </ul>
    
</div>

<script>
let draggingItem = null;
let touchStartX = 0;
let touchStartY = 0;
let lastTapTime = 0;
let isDragging = false;
const maxSongs = 24;
const originalAlbumMap = new Map();

/**
 * ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã‚’æœ‰åŠ¹ã«ã™ã‚‹é–¢æ•°ã€‚
 * @param {Element} list - æœ‰åŠ¹ã«ã™ã‚‹ãƒªã‚¹ãƒˆã®è¦ç´ 
 */
 function enableDragAndDrop(list) {
    list.querySelectorAll(".item").forEach(item => {
        if (!originalAlbumMap.has(item)) {
            originalAlbumMap.set(item, list);
        }
        item.addEventListener("dragstart", handleDragStart);
        item.addEventListener("dragend", handleDragEnd);
        item.addEventListener("touchstart", handleTouchStart);
        item.addEventListener("touchmove", handleTouchMove);
        item.addEventListener("touchend", handleTouchEnd); // ã“ã®è¡Œ
    });
    list.addEventListener("dragover", handleDragOver);
    list.addEventListener("drop", handleDrop);

    function handleTouchEnd(event) {
        if (isDragging) {
            const closestItem = getClosestItem(event.changedTouches[0].clientY);
            if (closestItem) {
                const bounding = closestItem.getBoundingClientRect();
                const offset = event.changedTouches[0].clientY - bounding.top;
                requestAnimationFrame(() => {
                    if (closestItem && draggingItem) {
                        closestItem.parentElement.insertBefore(draggingItem, offset > bounding.height / 2 ? closestItem.nextSibling : closestItem.before(closestItem));
                        const setlist = document.getElementById("setlist");
                        updateSetlistItem(draggingItem, setlist);
                    }
                });
            }
        }
        finishDragging();
        isDragging = false;
    }
}


/**
 * ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹æ™‚ã®å‡¦ç†ã€‚
 * @param {DragEvent} event - ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆ
 */
function handleDragStart(event) {
    draggingItem = this;
    draggingItem.classList.add("dragging");
    event.dataTransfer.setData("text/plain", "");
}

/**
 * ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®å‡¦ç†ã€‚
 * @param {DragEvent} event - ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆ
 */
function handleDragOver(event) {
    event.preventDefault();
    if (!draggingItem) return;
    const closestItem = getClosestItem(event.clientY);
    if (closestItem) {
        const bounding = closestItem.getBoundingClientRect();
        const offset = event.clientY - bounding.top;
        requestAnimationFrame(() => {
            if (closestItem && draggingItem) {
                closestItem.parentElement.insertBefore(
                    draggingItem,
                    offset > bounding.height / 2 ? closestItem.nextSibling : closestItem.before(closestItem)
                );
            }
        });
    }
}

/**
 * æŒ‡å®šã•ã‚ŒãŸYåº§æ¨™ã«æœ€ã‚‚è¿‘ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã™ã‚‹ã€‚
 * @param {number} y - Yåº§æ¨™
 * @returns {Element} æœ€ã‚‚è¿‘ã„ã‚¢ã‚¤ãƒ†ãƒ 
 */
function getClosestItem(y) {
    const children = [...setlist.children].filter(child => child !== draggingItem); // draggingItemã‚’é™¤å¤–
    if (children.length === 0) {
        return null; // å­è¦ç´ ãŒãªã„å ´åˆã¯ null ã‚’è¿”ã™
    }

    let closest = children[0];
    let closestOffset = Math.abs(y - (closest.getBoundingClientRect().top + closest.getBoundingClientRect().height / 2));

    for (let i = 1; i < children.length; i++) {
        const child = children[i];
        const offset = y - (child.getBoundingClientRect().top + child.getBoundingClientRect().height / 2);
        const absOffset = Math.abs(offset);

        if (absOffset < closestOffset) {
            closest = child;
            closestOffset = absOffset;
        }
    }
    return closest;
}

/**
 * ãƒ‰ãƒ­ãƒƒãƒ—æ™‚ã®å‡¦ç†ã€‚
 * @param {DragEvent} event - ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆ
 */
function handleDrop(event) {
    event.preventDefault();
    if (!draggingItem) return;
    const setlist = document.getElementById("setlist");
    if (setlist && setlist.children.length < maxSongs) { // setlistãŒnullã§ãªã„ã“ã¨ã‚’ç¢ºèª
        const closestItem = getClosestItem(event.clientY);
        let targetElement = closestItem;

        if (targetElement) {
            requestAnimationFrame(() => {
                 closestItem.parentElement.insertBefore(draggingItem, targetElement);
                 updateSetlistItem(draggingItem, setlist);
            });

        } else {
             requestAnimationFrame(() => {
                  setlist.appendChild(draggingItem);
                  updateSetlistItem(draggingItem, setlist);
             });
        }
    }
    finishDragging();
}

function updateSetlistItem(item, setlist) {
     if (item.parentElement === setlist && !item.classList.contains("setlist-item")) {
            const songInfo = document.createElement("div");
            songInfo.classList.add("song-info");
            const songName = document.createTextNode(item.textContent);
            songInfo.appendChild(songName);

            if (item.textContent.trim() === "ãƒˆã‚­ãƒãƒŠãƒŸãƒ€" || item.textContent.trim() === "SE") {
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                songInfo.appendChild(checkbox);
                const label = document.createElement("span");
                label.textContent = " (Short)";
                songInfo.appendChild(label);
            }

            item.innerHTML = "";
            item.appendChild(songInfo);
            item.classList.add("setlist-item");
            songInfo.style.paddingLeft = "20px";
            enableDragAndDrop(item.parentElement);
        }
}

/**
 * ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®å‡¦ç†ã€‚
 */
function handleDragEnd() {
    finishDragging();
}

/**
 * ã‚¿ãƒƒãƒé–‹å§‹æ™‚ã®å‡¦ç†
 * @param {TouchEvent} event
 */
function handleTouchStart(event) {
    draggingItem = this;
    draggingItem.classList.add("touchstart"); // touchstart ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
    touchStartX = event.touches[0].clientX;
    touchStartY = event.touches[0].clientY;
}

/**
 * ã‚¿ãƒƒãƒç§»å‹•æ™‚ã®å‡¦ç†
 * @param {TouchEvent} event
 */
function handleTouchMove(event) {
    event.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²ã
    if (!draggingItem) return;

    const touchX = event.touches[0].clientX;
    const touchY = event.touches[0].clientY;
    const deltaX = touchX - touchStartX;
    const deltaY = touchY - touchStartY;

    // ä¸€å®šè·é›¢ä»¥ä¸Šç§»å‹•ã—ãŸå ´åˆã«ãƒ‰ãƒ©ãƒƒã‚°ã¨ã¿ãªã™
    if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
        isDragging = true;
        draggingItem.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
        draggingItem.style.opacity = 0.5;
        const closestItem = getClosestItem(event.touches[0].clientY);
        if (closestItem) {
            const bounding = closestItem.getBoundingClientRect();
            const offset = event.touches[0].clientY - bounding.top;
            //closestItem.parentElement.insertBefore(draggingItem, offset > bounding.height / 2 ? closestItem.nextSibling : closestItem.before(closestItem));
            requestAnimationFrame(() => {
                closestItem.parentElement.insertBefore(draggingItem, offset > bounding.height / 2 ? closestItem.nextSibling : closestItem.before(closestItem));
            });
        }
    }
}

/**
 * ã‚¿ãƒƒãƒçµ‚äº†æ™‚ã®å‡¦ç†
 * @param {TouchEvent} event
 */
 function handleDrop(event) {
    event.preventDefault();
    if (!draggingItem) return;
    const setlist = document.getElementById("setlist");
    if (setlist && setlist.children.length < maxSongs) {
        const closestItem = getClosestItem(event.clientY);
        let targetElement = closestItem;

        if (targetElement) { // targetElementãŒnullã§ãªã„ã“ã¨ã‚’ç¢ºèª
            requestAnimationFrame(() => {
                 closestItem.parentElement.insertBefore(draggingItem, targetElement);
                 updateSetlistItem(draggingItem, setlist);
            });

        } else {
             requestAnimationFrame(() => {
                  setlist.appendChild(draggingItem);
                  updateSetlistItem(draggingItem, setlist);
             });
        }
    }
    finishDragging();
}

/**
 * ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®å‡¦ç†ã€‚
 */
function finishDragging() {
    if (!draggingItem) return;
    draggingItem.classList.remove("dragging");
    draggingItem.classList.remove("touchstart");
    draggingItem.style.transform = "";
    draggingItem.style.opacity = "";
    draggingItem = null;
    isDragging = false;
}

/**
 * ã‚¢ã‚¤ãƒ†ãƒ ã‚’å…ƒã®ãƒªã‚¹ãƒˆã«æˆ»ã™ã€‚
 * @param {Element} item - å…ƒã«æˆ»ã™ã‚¢ã‚¤ãƒ†ãƒ 
 */
function restoreToOriginalList(item) {
    const originalList = originalAlbumMap.get(item);
    if (originalList) {
        originalList.appendChild(item);
    }
}

document.addEventListener("dblclick", (event) => {
    const item = event.target.closest(".item");
    if (!item) return;
    event.preventDefault();
    event.stopPropagation();
    !!event.target.closest("#setlist") ? restoreToOriginalList(item) : null;
});

/**
 * ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é–‹é–‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚
 */
function toggleMenu() {
    document.getElementById("menu").classList.toggle("open");
    document.getElementById("menuButton").classList.toggle("open");
}

/**
 * ã‚¢ãƒ«ãƒãƒ ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚
 * @param {number} albumIndex - åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚¢ãƒ«ãƒãƒ ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
 */
function toggleAlbum(albumIndex) {
    document.querySelectorAll(".album-content").forEach(content => {
        content.id === "album" + albumIndex ? content.classList.toggle("active") : content.classList.remove("active");
    });
}

const setlist = document.getElementById("setlist");
if (setlist) enableDragAndDrop(setlist);
document.querySelectorAll(".album-content").forEach(enableDragAndDrop);

/**
 * ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆã®å†…å®¹ã‚’å–å¾—ã™ã‚‹ã€‚
 * @returns {string[]} ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆã®æ›²ãƒªã‚¹ãƒˆ
 */
function getSetlist() {
    return Array.from(document.querySelectorAll(".setlist-item"))
        .map((item, index) => `${index + 1}. ${item.textContent.trim().replace("ğŸ“¤", "").trim()}`);
}

/**
 * ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆã‚’å…±æœ‰ã™ã‚‹ã€‚
 */
function shareSetlist() {
    const setlistItems = document.querySelectorAll("#setlist li");
    if (setlistItems.length === 0) {
        alert("ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆã«æ›²ãŒã‚ã‚Šã¾ã›ã‚“ï¼");
        return;
    }
    let songList = "\n" + Array.from(setlistItems).map(item => {
            const songName = item.querySelector(".song-info").childNodes[0].textContent.trim();
            const checkbox = item.querySelector("input[type='checkbox']");
            return checkbox && checkbox.checked ? " " + songName + " (Short)" : " " + songName;
        }).join("\n");
    navigator.share ? navigator.share({ title: "ä»®ã‚»ãƒˆãƒª", text: songList }).catch(console.error) : alert("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯å…±æœ‰æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚");
}

document.querySelectorAll(".send-button").forEach(button => button.addEventListener("click", shareSetlist));

    </script>  

    
    

    

</body>
</html>
